(function(a,b){if('function'==typeof define&&define.amd)define(['exports','react','string-similarity','whatkey','lodash.isequal','styled-components','../../utils','../types','./terminal-utils','./styled-elements','../Bar','../Content/index','../Tabs/index'],b);else if('undefined'!=typeof exports)b(exports,require('react'),require('string-similarity'),require('whatkey'),require('lodash.isequal'),require('styled-components'),require('../../utils'),require('../types'),require('./terminal-utils'),require('./styled-elements'),require('../Bar'),require('../Content/index'),require('../Tabs/index'));else{var c={exports:{}};b(c.exports,a.React,a.stringSimilarity,a.whatkey,a.lodash,a.styledComponents,a.utils,a.types,a.terminalUtils,a.styledElements,a.Bar,a.index,a.index),a.index=c.exports}})(this,function(a,b,c,d,e,f,g,h,j,i,k,l,m){'use strict';function n(a){return a&&a.__esModule?a:{default:a}}function o(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function p(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function q(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function r(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function s(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(a,'__esModule',{value:!0});var t,u,v=n(b),w=n(c),x=n(d),y=n(e),z=n(k),A=n(l),B=n(m),C='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a},D=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},E=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),F=(u=t=function(a){function b(a){q(this,b);var c=r(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.componentWillMount=function(){c.loadPlugins(),c.assembleCommands(),c.setDescriptions(),c.setShortcuts(),c.createTab(!0),c.setState({prompt:c.props.promptSymbol})},c.componentDidMount=function(){c.props.watchConsoleLogging&&c.watchConsoleLogging()},c.createTab=function(){var a=0<arguments.length&&void 0!==arguments[0]&&arguments[0],b=c.props.allowTabs;if(a||b){var d=c.state.tabs,e=(0,j.uuidv4)();d.push(v.default.createElement(A.default,{key:e,id:e,handleChange:c.handleChange,handlerKeyPress:c.handlerKeyPress,register:function(){for(var a=arguments.length,b=Array(a),d=0;d<a;d++)b[d]=arguments[d];return c.registerInstance.apply(c,[e].concat(b))}})),c.setState({activeTab:e,tabs:d})}},c.removeTab=function(a){var b=c.state.tabs;b.splice(a,1),c.setState({tabs:b})},c.getAppContent=function(){var a=c.state,b=a.show,d=a.minimise;return b?d?c.getBar():c.getContent():c.getNote()},c.getContent=function(){var a=c.props,b=a.style,d=a.showActions,e=a.hideTopBar,f=a.allowTabs,g=a.actionHandlers,h=c.state,i=h.activeTab,j=h.tabs;return v.default.createElement(i.ContainerWrapper,{style:D({},b)},!e&&v.default.createElement(z.default,D({showActions:d},g)),f&&v.default.createElement(B.default,{active:i,setActiveTab:c.setActiveTab,createTab:c.createTab,removeTab:c.removeTab}),j)},c.getBar=function(){var a=c.props,b=a.style,d=a.showActions,e=a.actionHandlers;return v.default.createElement(i.ContainerWrapper,{style:D({},b)},v.default.createElement(z.default,D({showActions:d},e)))},c.getNote=function(){return v.default.createElement(i.Note,null,v.default.createElement('h1',null,'OOPS! You closed the window.'),v.default.createElement('img',{src:'https://camo.githubusercontent.com/95ad3fffa11193f85dedbf14ca67e4c5c07182d0/687474703a2f2f69636f6e732e69636f6e617263686976652e636f6d2f69636f6e732f70616f6d656469612f736d616c6c2d6e2d666c61742f313032342f7465726d696e616c2d69636f6e2e706e67',width:'200',height:'200',alt:'note',onClick:c.toggleState('show')}),'Click on the icon to reopen.')},c.getPluginData=function(a){return c.pluginData[a]},c.setPluginData=function(a,b){return c.pluginData[a]=b},c.setDescriptions=function(){var a=D({},c.defaultDesciptions,c.props.descriptions);(0,j.pluginMap)(c.props.plugins,function(b){b.descriptions&&(a=D({},a,b.descriptions))}),c.setState({descriptions:a})},c.setShortcuts=function(){var a=(0,j.getShortcuts)({},c.defaultShortcuts);a=(0,j.getShortcuts)(a,c.props.shortcuts),(0,j.pluginMap)(c.props.plugins,function(b){b.shortcuts&&(a=(0,j.getShortcuts)(a,b.shortcuts))}),c.setState({shortcuts:a})},c.setPromptPrefix=function(a,b){a.setState({promptPrefix:b})},c.setActiveTab=function(a){c.setState({activeTab:a})},c.setFalse=function(a){return function(){return c.setState(p({},a,!1))}},c.setTrue=function(a){return function(){return c.setState(p({},a,!0))}},c.setValueWithHistory=function(a,b,c){var d=a.state.history;d[b]&&(a.setState({historyCounter:b}),c.value=d[b])},c.registerInstance=function(a,b){var d=c.state.instances,e={},f={},g=d.find(function(b){return b.index===a});(0,j.pluginMap)(c.props.plugins,function(a,d){try{var h,i={printLine:c.printLine.bind(c,b),removeLine:c.removeLine.bind(c,b),runCommand:c.runCommand.bind(c,b),setCanScroll:c.setCanScroll.bind(c,b),setScrollPosition:c.setScrollPosition.bind(c,b),focusInput:c.focusInput.bind(c,b),setPromptPrefix:c.setPromptPrefix.bind(c,b),getPluginMethod:c.getPluginMethod.bind(c,b),getData:function(){return c.getPluginData(a.displayName)},setData:function(b){return c.setPluginData(a.displayName,b)},os:j.os};g?g.pluginInstances[a.displayName].updateApi(i):(h=new a(i,d),f[a.displayName]=D({},h.getPublicMethods(),{_getName:function(){return a.displayName},_getVersion:function(){return a.version}})),e[a.displayName]=h}catch(b){console.error('Error instantiating plugin '+a.displayName,b)}});var h={index:a,instance:b,pluginMethods:g?g.pluginMethods:f,pluginInstances:g?g.pluginInstances:e};if(g){var i=d.indexOf(g);d[i]=h}else d.push(h);return c.setState({instances:d}),function(){var a=c.state.instances;c.setState({instances:a.filter(function(a){return!(0,y.default)(a.instance,b)})})}},c.toggleState=function(a){return function(){return c.setState(p({},a,!c.state[a]))}},c.assembleCommands=function(){var a=D({},c.defaultCommands,c.props.commands);(0,j.pluginMap)(c.props.plugins,function(b){b.commands&&(a=D({},a,b.commands))}),c.setState({commands:(0,j.modCommands)(a)})},c.autocompleteValue=function(a){var b=c.state.descriptions,d=Object.keys(b).filter(function(a){return!1!==b[a]}),e=w.default.findBestMatch(a.value,d),f=e.bestMatch;return 0.5<=f.rating?f.target:a.value},c.clearScreen=function(a,b,c,d){d.setState({summary:[]})},c.checkShortcuts=function(a,b,d){var e=c.state.instances.find(function(b){return(0,y.default)(b.instance,a)}),f=c.state.shortcuts;e&&Object.values(e.pluginInstances).forEach(function(a){f=(0,j.getShortcuts)(f,a.shortcuts)});var g=Object.keys(f);if(0<g.length){var h=a.state.keyInputs,i=b;'meta'===b&&(i='darwin'===j.os?'cmd':'win'===j.os?'win':'meta'),h.push(i);var k=h.length,l=g.map(function(a,b){return[a.replace(/\s/g,'').split('+'),b]}).filter(function(a){return a[0].length>=h.length}).filter(function(a){return(0,y.default)(a[0].slice(0,k),h)});if(!(0<l.length))0<h.length&&a.setState({keyInputs:[]});else if(1===l.length&&l[0][0].length===k){var m=g[l[0][1]],n=f[m];'string'==typeof n?c.runCommand(a,f[m]):'function'==typeof n&&(d.preventDefault(),d.stopPropagation(),n()),a.setState({keyInputs:[]})}}},c.editLine=function(a,b,c,d){var e=d.state.summary,f=a.line;0>f&&(f=0===e.length?0:e.length-f),e[f]=a._.join(' '),d.setState({summary:e})},c.handleChange=function(a,b){var d=a.state,e=d.input,f=d.promptPrefix,g=d.history;if('Enter'===b.key&&!b.shiftKey){'undefined'==typeof b.dontShowCommand&&c.printLine.bind(c,a)(''+f+c.state.prompt+' '+b.target.value,!1),e.push(b.target.value);var h=c.runCommand(a,''+e.join('\n'));'undefined'!=typeof h&&c.printLine.bind(c,a)(h);var i=[].concat(o(g),[b.target.value]);a.setState({input:[],history:i,historyCounter:i.length}),b.target.value=''}else if('Enter'===b.key&&b.shiftKey){c.printLine.bind(c,a)(''+f+c.state.prompt+' '+b.target.value,!1);var j=[].concat(o(g),[b.target.value]);a.setState({input:[].concat(o(e),[b.target.value]),history:j,historyCounter:j.length}),b.target.value=''}},c.handlerKeyPress=function(a,b,d){var e=(0,x.default)(b).key,f=a.state,g=f.historyCounter,h=f.keyInputs;if(0===h.length)switch(e){case'up':c.setValueWithHistory(a,g-1,d);break;case'down':c.setValueWithHistory(a,g+1,d);break;case'tab':d.value=c.autocompleteValue(d),b.preventDefault();break;default:}c.checkShortcuts(a,e,b)},c.loadPlugins=function(){var a={};(0,j.pluginMap)(c.props.plugins,function(b){try{a[b.displayName]=b.defaultData}catch(a){console.error('Error loading plugin '+b.displayName,a)}}),c.pluginData=a},c.getPluginMethod=function(a,b,d){var e=c.state.instances.find(function(b){return(0,y.default)(b.instance,a)});if(e)if(e.pluginMethods[b]){if(e.pluginMethods[b][d])return e.pluginMethods[b][d];throw console.log(e.pluginMethods[b]),new Error('No method with name '+d+' has been registered for plugin '+b)}else throw new Error('No plugin with name '+b+' has been registered');return null},c.setCanScroll=function(a,b){'undefined'!=typeof b&&a.setState({canScroll:b})},c.setScrollPosition=function(a,b){'number'==typeof b&&a.setScrollPosition(b)},c.focusInput=function(a){'number'==typeof pos&&a.focusInput()},c.printLine=function(a,b){var d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!0,e=!0;if(d){var f=c.state.instances.find(function(b){return(0,y.default)(b.instance,a)});if(f)for(var g=f.pluginInstances,h=0;h<g.length;h+=1)try{e=g[h].readStdOut(b)}catch(a){}}if(!1!==e){var i=a.state.summary;i.push(b),a.setState({summary:i})}},c.removeLine=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1,c=a.state.summary;c.splice(b,1),a.setState({summary:c})},c.runCommand=function(a,b){var d=b.split(' '),e=d[0],f=c.state.instances.find(function(b){return(0,y.default)(b.instance,a)}),g=D({},c.state.commands);f&&Object.values(f.pluginInstances).forEach(function(a){g=D({},g,(0,j.modCommands)(a.commands))});var h,i=g[e];if(''===e);else if(void 0===i)'function'==typeof c.props.commandPassThrough?h=c.props.commandPassThrough(d,c.printLine.bind(c,a),c.runCommand.bind(c,a)):c.printLine.bind(c,a)('-bash:'+e+': command not found');else{var k=i.parse(d),l='undefined'==typeof k?'undefined':C(k);'object'===l&&('object'!==l||k.help)||(h=i.method(k,c.printLine.bind(c,a),c.runCommand.bind(c,a),!0===i.needsInstance?a:void 0))}return h},c.printToActive=function(){for(var a=arguments.length,b=Array(a),d=0;d<a;d++)b[d]=arguments[d];var e=c.state.instances.find(function(a){return a.index===c.state.activeTab});e&&null!==e.instance&&c.printLine.apply(c,[e.instance].concat(b))},c.watchConsoleLogging=function(){(0,g.handleLogging)('log',c.printToActive),(0,g.handleLogging)('info',c.printToActive)},c.showHelp=function(a,b,d,e){var f=D({},c.state.commands),g=D({},c.state.descriptions),h=c.state.instances.find(function(a){return(0,y.default)(a.instance,e)});h&&Object.values(h.pluginInstances).forEach(function(a){f=D({},f,a.commands),g=D({},g,a.descriptions)});var i=Object.keys(f),j=!0,k=!1,l=void 0;try{for(var m,n,o=i[Symbol.iterator]();!(j=(m=o.next()).done);j=!0)n=m.value,!1!==g[n]&&b(n+' - '+g[n])}catch(a){k=!0,l=a}finally{try{!j&&o.return&&o.return()}finally{if(k)throw l}}},c.showMsg=function(a,b){c.props.msg&&0<c.props.msg.length&&b(c.props.msg)},c.pluginData={},c.defaultCommands={show:c.showMsg,clear:{method:c.clearScreen,needsInstance:!0},help:{method:c.showHelp,needsInstance:!0},echo:function(a){return a.slice(1).join(' ')},"edit-line":{method:c.editLine,needsInstance:!0,options:[{name:'line',description:'the line you want to edit. -1 is the last line',init:function(a){return parseInt(a,10)},defaultValue:-1}]}},c.defaultDesciptions={show:a.msg&&0<a.msg.length&&'show the msg',clear:'clear the screen',help:'list all the commands',echo:!1,"edit-line":!1},c.defaultShortcuts={"win, linux, darwin":{"alt + t":c.createTab},"win, linux":{"ctrl + l":'clear'},darwin:{"cmd + k":'clear'}},c.state={prompt:'>',commands:{},descriptions:{},show:'closed'!==a.startState,minimise:'minimised'===a.startState,maximise:'maximised'===a.startState,shortcuts:{},activeTab:'',tabs:[],instances:[]},c}return s(b,a),E(b,[{key:'getChildContext',value:function(){return{instances:this.state.instances,symbol:this.state.prompt,show:this.state.show,minimise:this.state.minimise,maximise:this.state.maximise,activeTab:this.state.activeTab,barShowing:!this.props.hideTopBar,tabsShowing:this.props.allowTabs,openWindow:this.setTrue('show'),closeWindow:this.setFalse('show'),minimiseWindow:this.setTrue('minimise'),unminimiseWindow:this.setFalse('minimise'),maximiseWindow:this.setTrue('maximise'),unmaximiseWindow:this.setFalse('maximise'),toggleShow:this.toggleState('show'),toggleMaximise:this.toggleState('maximise'),toggleMinimize:this.toggleState('minimise')}}},{key:'render',value:function(){var a={color:this.props.color,prompt:this.props.prompt,barColor:this.props.barColor,backgroundColor:this.props.backgroundColor};return v.default.createElement(f.ThemeProvider,{theme:a},v.default.createElement(i.Base,{className:'terminal-base',fullscreen:this.state.maximise},this.getAppContent()))}}]),b}(b.Component),t.displayName='Terminal',t.propTypes=h.TerminalPropTypes,t.defaultProps=h.TerminalDefaultProps,t.childContextTypes=h.TerminalContextTypes,u);a.default=F});
//# sourceMappingURL=index.js.map